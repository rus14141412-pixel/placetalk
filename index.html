<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>placetalk</title>

<style>
:root{
  --bg:#0f0f10;
  --text:#f2f2f3;
  --muted:#b4b4b8;
  --line:#2a2a2c;
  --panel:#171718;
  --chip:#232325;
  --shadow: 0 14px 44px rgba(0,0,0,.5);
  --r: 18px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif;
  background:
    radial-gradient(1200px 700px at 20% -10%, rgba(255,255,255,.06), transparent 60%),
    radial-gradient(900px 600px at 90% 10%, rgba(255,255,255,.04), transparent 55%),
    var(--bg);
  color:var(--text);
  font-size:16px;
}
.wrap{max-width:1100px;margin:0 auto;padding:28px 18px 60px}
.topbar{
  display:flex;justify-content:space-between;align-items:center;gap:12px;
  padding:22px;border:1px solid var(--line);border-radius:22px;
  background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  box-shadow:var(--shadow);
}
.brand{display:flex;gap:14px;align-items:center}
.logo{width:44px;height:44px;border-radius:14px;background:#1e1e20;border:1px solid var(--line)}
.brand h1{margin:0;font-size:22px;font-weight:650}
.brand p{margin:4px 0 0;color:var(--muted);font-size:15px}
.actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.btn{
  padding:12px 16px;border-radius:14px;border:1px solid var(--line);
  background:#18181a;color:var(--text);cursor:pointer;font-size:15px;
}
.btn:hover{background:#1f1f22}
.btn.primary{background:#1b1b1d}
.btn.primary:hover{background:#232326}
.pill{
  padding:7px 12px;border-radius:999px;border:1px solid var(--line);
  background:var(--chip);color:var(--muted);font-size:13px;
}
.grid{display:grid;grid-template-columns:1.35fr .65fr;gap:20px;margin-top:22px}
@media (max-width:900px){.grid{grid-template-columns:1fr}}
.card{
  border:1px solid var(--line);border-radius:var(--r);
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
  box-shadow:var(--shadow);overflow:hidden;
}
.cardHeader{padding:22px;display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
.cardHeader h2{margin:0;font-size:18px}
.sub{margin-top:8px;color:var(--muted);font-size:15px;line-height:1.45}
.search{
  width:280px;max-width:48vw;padding:11px 12px;border-radius:14px;
  border:1px solid var(--line);background:#121214;color:var(--text);outline:none;
}
.search::placeholder{color:#7f7f86}
.list{border-top:1px solid var(--line)}
.row{
  padding:18px 22px;border-top:1px solid rgba(255,255,255,.03);
  display:flex;justify-content:space-between;gap:14px;cursor:pointer;
}
.row:first-child{border-top:none}
.row:hover{background:rgba(255,255,255,.03)}
.title{font-size:16px;font-weight:600}
.meta{margin-top:6px;font-size:14px;color:var(--muted)}
.right{text-align:right;min-width:170px}
.small{margin-top:8px;font-size:13px;color:var(--muted)}
.side{padding:22px}
.hr{height:1px;background:var(--line);margin:16px 0}
.post{
  margin-top:14px;padding:16px;border-radius:14px;border:1px solid var(--line);
  background:#151517;
}
.who{display:flex;justify-content:space-between;gap:10px;font-size:14px;color:var(--muted)}
.text{margin-top:10px;font-size:16px;line-height:1.6}
.footer{margin-top:18px;text-align:center;font-size:13px;color:var(--muted)}
.modalBack{
  position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;
  align-items:center;justify-content:center;padding:18px;
}
.modal{
  width:min(680px, 96vw);border:1px solid var(--line);border-radius:18px;
  background:#121214;box-shadow:var(--shadow);padding:18px;
}
.modal h3{margin:0 0 10px;font-size:18px}
.field{margin-top:10px}
.input, .textarea{
  width:100%;padding:12px 12px;border-radius:14px;border:1px solid var(--line);
  background:#0f0f11;color:var(--text);outline:none;font-size:15px;
}
.textarea{min-height:120px;resize:vertical;line-height:1.5}
.modalActions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px;flex-wrap:wrap}
.link{color:var(--muted);text-decoration:underline;cursor:pointer}
.topline{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
</style>
</head>

<body>
<div class="wrap">
  <div class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>placetalk</h1>
        <p>ламповое место для спокойных разговоров</p>
      </div>
    </div>
    <div class="actions">
      <span class="pill" id="whoPill">гость</span>
      <button class="btn" id="loginBtn">Ник</button>
      <button class="btn primary" id="newTopicBtn">Создать тему</button>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="cardHeader">
        <div>
          <h2 id="mainTitle">Разделы</h2>
          <div class="sub" id="mainSub">Пока без регистрации и серверов — но уже можно писать.</div>
        </div>
        <input class="search" id="search" placeholder="Поиск по темам..." />
      </div>

      <div class="list" id="list"></div>
    </div>

    <div class="card">
      <div class="side">
        <div class="topline">
          <h2 style="margin:0;font-size:18px">Панель</h2>
          <span class="pill" id="countPill">тем: 0</span>
        </div>
        <div class="sub" style="margin-top:8px">
          <span class="link" id="homeLink">На главную</span> ·
          <span class="link" id="seedLink">Заполнить примером</span> ·
          <span class="link" id="clearLink">Очистить</span>
        </div>

        <div class="hr"></div>

        <h2 style="margin:0;font-size:18px">Как это работает</h2>
        <div class="sub" style="margin-top:8px">
          Ник и сообщения сохраняются <b>в твоём браузере</b>. Это “живой макет”, следующий шаг — настоящая база.
        </div>

        <div class="footer">placetalk • local prototype</div>
      </div>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modalBack" id="modalBack">
  <div class="modal" id="modal">
    <h3 id="modalTitle">Окно</h3>
    <div id="modalBody"></div>
    <div class="modalActions">
      <button class="btn" id="cancelBtn">Отмена</button>
      <button class="btn primary" id="okBtn">Ок</button>
    </div>
  </div>
</div>

<script>
const LS_KEY = "placetalk_forum_v1";
const LS_NICK = "placetalk_nick_v1";

function nowLabel(){
  const d = new Date();
  const pad = n => String(n).padStart(2,"0");
  return `${pad(d.getDate())}.${pad(d.getMonth()+1)} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
}

function loadState(){
  const raw = localStorage.getItem(LS_KEY);
  if(raw){
    try { return JSON.parse(raw); } catch(e){}
  }
  return { topics: [] };
}
function saveState(s){ localStorage.setItem(LS_KEY, JSON.stringify(s)); }

function getNick(){
  return localStorage.getItem(LS_NICK) || "гость";
}
function setNick(n){
  localStorage.setItem(LS_NICK, n.trim() || "гость");
  renderHeader();
}

let state = loadState();
let view = { mode:"home", topicId:null, q:"" };

function renderHeader(){
  document.getElementById("whoPill").textContent = getNick();
}

function id(){
  return Math.random().toString(36).slice(2) + Date.now().toString(36);
}

function openModal(title, bodyHtml, onOk){
  const back = document.getElementById("modalBack");
  const body = document.getElementById("modalBody");
  document.getElementById("modalTitle").textContent = title;
  body.innerHTML = bodyHtml;
  back.style.display = "flex";

  const cancel = () => { back.style.display = "none"; };
  document.getElementById("cancelBtn").onclick = cancel;

  document.getElementById("okBtn").onclick = () => {
    const res = onOk?.();
    if(res !== false) cancel();
  };
}

function formatTopics(topics){
  const q = view.q.trim().toLowerCase();
  if(!q) return topics;
  return topics.filter(t =>
    t.title.toLowerCase().includes(q) ||
    (t.body || "").toLowerCase().includes(q) ||
    t.posts.some(p => p.text.toLowerCase().includes(q))
  );
}

function renderHome(){
  document.getElementById("mainTitle").textContent = "Темы";
  document.getElementById("mainSub").textContent = "Создай тему — и она появится здесь. Пока всё хранится в браузере.";
  const list = document.getElementById("list");
  const topics = formatTopics([...state.topics].sort((a,b)=>b.createdAt-a.createdAt));
  document.getElementById("countPill").textContent = `тем: ${state.topics.length}`;

  if(topics.length === 0){
    list.innerHTML = `
      <div class="row" style="cursor:default">
        <div>
          <div class="title">Пока пусто</div>
          <div class="meta">Нажми “Создать тему” или “Заполнить примером”.</div>
        </div>
        <div class="right"><span class="pill">0</span><div class="small">сообщений</div></div>
      </div>`;
    return;
  }

  list.innerHTML = topics.map(t => {
    const replies = t.posts.length;
    const last = replies ? t.posts[t.posts.length-1].at : t.at;
    return `
      <div class="row" data-open="${t.id}">
        <div>
          <div class="title">${escapeHtml(t.title)}</div>
          <div class="meta">${escapeHtml(t.body.slice(0,90))}${t.body.length>90?"…":""}</div>
        </div>
        <div class="right">
          <span class="pill">${replies} ответов</span>
          <div class="small">последнее: ${escapeHtml(last)}</div>
        </div>
      </div>
    `;
  }).join("");

  [...list.querySelectorAll("[data-open]")].forEach(el=>{
    el.onclick = ()=>openTopic(el.getAttribute("data-open"));
  });
}

function renderTopic(topic){
  document.getElementById("mainTitle").textContent = topic.title;
  document.getElementById("mainSub").textContent = `Автор: ${topic.author} • ${topic.at}`;
  const list = document.getElementById("list");
  document.getElementById("countPill").textContent = `ответов: ${topic.posts.length}`;

  const postsHtml = topic.posts.map(p=>`
    <div class="row" style="cursor:default;align-items:flex-start">
      <div style="width:100%">
        <div class="who">
          <span>@${escapeHtml(p.author)}</span>
          <span>${escapeHtml(p.at)}</span>
        </div>
        <div class="text">${escapeHtml(p.text)}</div>
      </div>
    </div>
  `).join("");

  list.innerHTML = `
    <div class="row" style="cursor:default;align-items:flex-start">
      <div style="width:100%">
        <div class="who">
          <span>@${escapeHtml(topic.author)}</span>
          <span>${escapeHtml(topic.at)}</span>
        </div>
        <div class="text">${escapeHtml(topic.body)}</div>
      </div>
    </div>

    <div style="padding:18px 22px;border-top:1px solid var(--line)">
      <button class="btn primary" id="replyBtn">Ответить</button>
    </div>

    ${postsHtml}
  `;

  document.getElementById("replyBtn").onclick = () => {
    openModal("Ответить", `
      <div class="field">
        <textarea class="textarea" id="replyText" placeholder="Твой ответ..."></textarea>
      </div>
    `, () => {
      const text = (document.getElementById("replyText").value || "").trim();
      if(!text){ alert("Напиши текст ответа"); return false; }
      const t = state.topics.find(x=>x.id===topic.id);
      t.posts.push({ id:id(), author:getNick(), at: nowLabel(), text });
      saveState(state);
      openTopic(topic.id);
    });
  };
}

function render(){
  renderHeader();
  if(view.mode==="home") renderHome();
  else {
    const t = state.topics.find(x=>x.id===view.topicId);
    if(!t){ view.mode="home"; view.topicId=null; renderHome(); return; }
    renderTopic(t);
  }
}

function openTopic(topicId){
  view.mode="topic";
  view.topicId=topicId;
  render();
}

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, c => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[c]));
}

// UI actions
document.getElementById("loginBtn").onclick = () => {
  openModal("Твой ник", `
    <div class="field">
      <input class="input" id="nickInput" placeholder="Например: ruslan" value="${escapeHtml(getNick()==="гость"?"":getNick())}">
      <div class="sub" style="margin-top:8px">Это не регистрация — просто имя, чтобы подписывать сообщения.</div>
    </div>
  `, () => {
    const n = (document.getElementById("nickInput").value || "").trim();
    if(n.length>20){ alert("Слишком длинный ник (до 20 символов)"); return false; }
    setNick(n || "гость");
  });
};

document.getElementById("newTopicBtn").onclick = () => {
  openModal("Создать тему", `
    <div class="field">
      <input class="input" id="topicTitle" placeholder="Название темы (коротко)">
    </div>
    <div class="field">
      <textarea class="textarea" id="topicBody" placeholder="О чём хочешь поговорить?"></textarea>
    </div>
  `, () => {
    const title = (document.getElementById("topicTitle").value || "").trim();
    const body  = (document.getElementById("topicBody").value || "").trim();
    if(!title){ alert("Нужно название"); return false; }
    if(title.length>80){ alert("Слишком длинное название (до 80 символов)"); return false; }
    if(!body){ alert("Нужен текст"); return false; }

    const t = {
      id: id(),
      title,
      body,
      author: getNick(),
      at: nowLabel(),
      createdAt: Date.now(),
      posts: []
    };
    state.topics.unshift(t);
    saveState(state);
    view.mode="home";
    view.topicId=null;
    render();
  });
};

document.getElementById("homeLink").onclick = () => {
  view.mode="home"; view.topicId=null; render();
};

document.getElementById("seedLink").onclick = () => {
  if(state.topics.length) { alert("Уже есть темы. Если хочешь пример — сначала очисти."); return; }
  state.topics = [
    { id:id(), title:"Правила и атмосфера placetalk", body:"Давайте без токсичности. Спокойно общаемся, не унижаем друг друга.", author:"admin", at:nowLabel(), createdAt:Date.now()-50000, posts:[
      {id:id(), author:"user", at:nowLabel(), text:"Поддерживаю. Пусть будет уютно."}
    ]},
    { id:id(), title:"Идеи для развития форума", body:"Что добавить первым: категории, поиск, лайки, закрепы?", author:"admin", at:nowLabel(), createdAt:Date.now()-80000, posts:[]}
  ];
  saveState(state);
  render();
};

document.getElementById("clearLink").onclick = () => {
  openModal("Очистить всё?", `
    <div class="sub">Удалит все темы и ответы в этом браузере. Это необратимо.</div>
  `, () => {
    state = { topics: [] };
    saveState(state);
    view.mode="home"; view.topicId=null;
    render();
  });
};

document.getElementById("search").addEventListener("input", (e)=>{
  view.q = e.target.value || "";
  if(view.mode==="home") renderHome();
});

// init
renderHeader();
render();
</script>
</body>
</html>
