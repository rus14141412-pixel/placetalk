<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>placetalk</title>

<style>
:root{
  --bg:#0f0f10;
  --text:#f2f2f3;
  --muted:#b4b4b8;
  --line:#2a2a2c;
  --chip:#232325;
  --shadow: 0 14px 44px rgba(0,0,0,.5);
  --r: 18px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif;
  background:
    radial-gradient(1200px 700px at 20% -10%, rgba(255,255,255,.06), transparent 60%),
    radial-gradient(900px 600px at 90% 10%, rgba(255,255,255,.04), transparent 55%),
    var(--bg);
  color:var(--text);
  font-size:16px;
}
.wrap{max-width:1100px;margin:0 auto;padding:28px 18px 60px}
.topbar{
  display:flex;justify-content:space-between;align-items:center;gap:12px;
  padding:22px;border:1px solid var(--line);border-radius:22px;
  background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  box-shadow:var(--shadow);
}
.brand{display:flex;gap:14px;align-items:center}
.logo{width:44px;height:44px;border-radius:14px;background:#1e1e20;border:1px solid var(--line)}
.brand h1{margin:0;font-size:22px;font-weight:650}
.brand p{margin:4px 0 0;color:var(--muted);font-size:15px}
.actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.btn{
  padding:12px 16px;border-radius:14px;border:1px solid var(--line);
  background:#18181a;color:var(--text);cursor:pointer;font-size:15px;
}
.btn:hover{background:#1f1f22}
.btn.primary{background:#1b1b1d}
.btn.primary:hover{background:#232326}
.pill{
  padding:7px 12px;border-radius:999px;border:1px solid var(--line);
  background:var(--chip);color:var(--muted);font-size:13px;
}
.grid{display:grid;grid-template-columns:1.35fr .65fr;gap:20px;margin-top:22px}
@media (max-width:900px){.grid{grid-template-columns:1fr}}
.card{
  border:1px solid var(--line);border-radius:var(--r);
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
  box-shadow:var(--shadow);overflow:hidden;
}
.cardHeader{padding:22px;display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
.cardHeader h2{margin:0;font-size:18px}
.sub{margin-top:8px;color:var(--muted);font-size:15px;line-height:1.45}
.controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.search{
  width:240px;max-width:48vw;padding:11px 12px;border-radius:14px;
  border:1px solid var(--line);background:#121214;color:var(--text);outline:none;
}
.select{
  padding:11px 12px;border-radius:14px;border:1px solid var(--line);
  background:#121214;color:var(--text);outline:none;font-size:14px;
}
.list{border-top:1px solid var(--line)}
.row{
  padding:18px 22px;border-top:1px solid rgba(255,255,255,.03);
  display:flex;justify-content:space-between;gap:14px;cursor:pointer;
}
.row:hover{background:rgba(255,255,255,.03)}
.title{font-size:16px;font-weight:600}
.meta{margin-top:6px;font-size:14px;color:var(--muted)}
.right{text-align:right;min-width:170px}
.small{margin-top:8px;font-size:13px;color:var(--muted)}
.side{padding:22px}
.hr{height:1px;background:var(--line);margin:16px 0}
.notice{
  margin-top:10px;padding:10px 12px;border:1px solid var(--line);
  border-radius:14px;background:#141416;color:var(--muted);
}
</style>
</head>

<body>
<div class="wrap">
  <div class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>placetalk</h1>
        <p>ламповое место для спокойных разговоров</p>
      </div>
    </div>
    <div class="actions">
      <span class="pill" id="whoPill">гость</span>
      <button class="btn" id="loginBtn">Ник</button>
      <button class="btn primary" id="newTopicBtn">Создать тему</button>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="cardHeader">
        <div>
          <h2 id="mainTitle">Темы</h2>
          <div class="sub" id="mainSub">Категории, антиспам и жалобы включены</div>
          <div class="notice" id="statusBox">Подключаемся…</div>
        </div>
        <div class="controls">
          <select class="select" id="catFilter">
            <option value="all">Все категории</option>
            <option>Обсуждения</option>
            <option>Идеи</option>
            <option>Общение</option>
            <option>Новости</option>
          </select>
          <input class="search" id="search" placeholder="Поиск..." />
        </div>
      </div>
      <div class="list" id="list"></div>
    </div>

    <div class="card">
      <div class="side">
        <h2>Панель</h2>
        <span class="pill" id="countPill">тем: 0</span>
        <div class="hr"></div>
        <div class="sub">
          <span id="homeLink" style="cursor:pointer">На главную</span> ·
          <span id="clearLink" style="cursor:pointer">Сбросить ник</span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const SUPABASE_URL = "https://wfwvzvghmkbhvqcwusma.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indmd3Z6dmdobWtiaHZxY3d1c21hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1NDQ2MTksImV4cCI6MjA4NDEyMDYxOX0.wCmHEOsdrm__Sa-4-CzRs-wLICqsW6vEPmY5ucf9OTo";
const REST = `${SUPABASE_URL}/rest/v1`;

function headers(){
  return {
    apikey: SUPABASE_KEY,
    Authorization: `Bearer ${SUPABASE_KEY}`,
    Accept: "application/json"
  };
}

async function restGet(path){
  const r = await fetch(REST + path, { headers: headers() });
  const t = await r.text();
  if(!r.ok) throw new Error(t);
  return t ? JSON.parse(t) : [];
}

async function loadTopics(){
  const data = await restGet(
    "/topics?select=id,title,body,author,category,created_at&is_hidden=eq.false&order=created_at.desc"
  );
  const list = document.getElementById("list");
  document.getElementById("countPill").textContent = `тем: ${data.length}`;
  list.innerHTML = data.map(t=>`
    <div class="row">
      <div>
        <div class="title">${t.title}</div>
        <div class="meta">@${t.author} • ${new Date(t.created_at).toLocaleString()}</div>
      </div>
      <div class="right"><span class="pill">${t.category}</span></div>
    </div>
  `).join("");
}

(async()=>{
  try{
    await loadTopics();
    document.getElementById("statusBox").textContent = "✅ подключено";
  }catch(e){
    document.getElementById("statusBox").textContent = "⚠️ " + e.message;
  }
})();
</script>
</body>
</html>
